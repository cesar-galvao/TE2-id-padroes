---
title: "GMM"
subtitle: "Gaussian Mixture Models"
author:
  - César A. Galvão - 190011572
  - Gabriela Carneiro - 180120816
  - João Vitor Vasconcelos - 170126064
  - Kevyn Andrade de Souza - 190015853
format:
  revealjs: 
    embed-resources: true
    self-contained: true
    slide-number: true
    preview-links: auto
    width: 1600
    heigth: 900
    scrollable: true
    css: styles.css
    footer: Estatística Aplicada
resources:
  - demo.pdf
editor_options: 
  chunk_output_type: console
---


```{r}
options(OutDec = ",")


if(!require("pacman")) install.packages("pacman")

pacman::p_load(
  readxl,
  tidyverse,
  gt,
  latex2exp)


source("utils/functions.R")
```

---

# Contextualização

# Testes de hipóteses

- Para média $\mu$ com variância conhecida
- Para proporção $p$



## Motivação

- Considere o problema de testar se a [taxa de analfabetismo no Distrito Federal é maior do que a taxa de 2,2\% em São Paulo]{style="color:blue"}. Para isso, é preciso obter informações sobre um parâmetro ($\theta_0$) desconhecido.

- De maneira geral, $\theta_0$ pode ser: 


::: {style="margin-left: 2em"}
::: {.nonincremental}
  - média populacional ($\mu$)
  - proporção populacional ($p$)
  - variância populacional ($\sigma^2$)
:::
:::




## Notações e conceitos {auto-animate="true"}

1. Chamamos de [hipótese]{style="color:blue"} a afirmação com respeito ao parâmetro desconhecido $\theta_0$:

::: {style="margin-left: 2em"}
::: incremental
1.1) [Hipótese nula]{style="text-decoration: underline"}: $H_0: \theta = \theta_0 \longrightarrow \text{estamos colocando à prova}$

1.2) [Hipótese alternativa]{style="text-decoration: underline"} (será considerada aceitável caso $H_0$ seja rejeitada): $H_a: \theta \neq \theta_0 \: ou \: (\theta > \theta_0)\: ou \: (\theta < \theta_0)$
:::
:::








## Notações e conceitos {auto-animate="true"}

1. Chamamos de hipótese a afirmação com respeito ao parâmetro desconhecido $\theta_0$:

::: {style="margin-left: 2em"}
::: incremental
1.1) [Hipótese nula]{style="text-decoration: underline"}: $H_0: \theta = \theta_0 \longrightarrow \text{estamos colocando à prova}$

1.2) [Hipótese alternativa]{style="text-decoration: underline"} (será considerada aceitável caso $H_0$ seja rejeitada): $H_a: \theta \neq \theta_0 \: ou \: (\theta > \theta_0)\: ou \: (\theta < \theta_0)$
:::
:::



::: {style="margin-top: 1.3em"}
O objetivo de um teste de hipóteses é [decidir se a hipótese nula deve ser rejeitada ou não]{style="color:red"}, com base em uma amostra de dados e uma estatística $\hat{\theta}$.
:::


## Região crítica



::: columns
::: {.column width="60%"}


::: {style="font-size: 1.3em"}

::: {.nonincremental}
- Se $\hat{\theta}$ pertencer a uma determinada região crítica (RC), [rejeitamos $H_0$]{style="color:red"}. Caso contrário, não rejeitamos.


- A região crítica é sempre construída sob a hipótese $H_0$ ser verdadeira.
:::

:::
:::

::: {.column width="40%"}


```{r}
#| cache: true
#| fig-height: 6.5


normal_args <- c(0, 5)

data.frame(x = -20:20) |>
  ggplot(aes(x)) +
  stat_function(
    fun  = dnorm,
    args = normal_args,
    geom = 'area',
    xlim = c(-20, -10),
    fill = 'steelblue'
  ) +
  stat_function(fun = dnorm,
                args = normal_args) +
  #geom_vline(xintercept = 0, color = "red3") +
  geom_vline(xintercept = c(-10), linetype = "dotted") +
  geom_curve(
    aes(
      x = -12,
      y = 0.003,
      xend = -14,
      yend = 0.02
    ),
    curvature = 0.2,
    arrow = arrow(length = unit(0.03, "npc"), type = "closed")
  ) +
  geom_curve(
    aes(
      x = 3,
      y = 0.045,
      xend = 7,
      yend = 0.07
    ),
    curvature = -0.5,
    arrow = arrow(length = unit(0.03, "npc"), type = "closed")
  ) +
  annotate(
    "text",
    x = -18,
    y = 0.025,
    label = "região \n crítica",
    # parse = TRUE,
    size = 15
  ) +
  annotate(
    "text",
    x = 13,
    y = 0.07,
    label = "região de \n aceitação",
    # parse = TRUE,
    size = 15
  ) +
  scale_x_continuous(breaks = c(-10),
                     labels = c(TeX("$\\bar{x}_{crítico}$"))) +
  theme_minimal() +
  grids_titulos_normal +
  labs(x = NULL) 
```
:::
:::




## Tipos de erro




::: columns
::: {.column width="50%"}

::: {style="font-size: 1em"}
::: {.callout-note}
## Erros possíveis em cada decisão
Para cada decisão que tomamos, existem dois tipos de erro que podem ocorrer:
:::

:::

```{r}



tibble(
  "Decisão" = c("Rejeitar hipótese nula", "Não rejeitar hipótese nula"),
  "Hipótese nula verdadeira" = c("Erro do Tipo I", "-"),
  "Hipótese nula falsa" = c("-", "Erro do Tipo II")
) |>
  gt() |>
  tab_style(style = cell_text(align = "center"),
            locations = cells_body(columns = c(
              "Hipótese nula verdadeira", "Hipótese nula falsa"
            ))) |>
  tab_style(
    style = list(cell_fill(color = "#F9E3D6"),
                 cell_text(weight = "bold")),
    locations = cells_body(rows = `Hipótese nula verdadeira` == "Erro do Tipo I",
                           columns = `Hipótese nula verdadeira`)
  ) |> 
  tab_options(table.font.size = px(25))


```


:::

::: {.column width="50%"}


::: {style="font-size: 0.8em; margin-top: 1em"}
Chamaremos de [nível de significância]{style="color:blue"} a probabilidade de cometer um erro do tipo I, ou seja:
\begin{align*}
\alpha &= P(\text{erro do tipo I}) \\
&= P(\text{rejeitar }H_0|H_0\text{ é verdadeira})
\end{align*}

Definimos também a probabilidade de erro do tipo II como:

\begin{align*}
\beta &= P(\text{erro do tipo II}) \\
&= P(\text{não rejeitar }H_0|H_0\text{ é falsa})
\end{align*}

:::


:::
:::




## Construção de um teste de hipóteses

::: {style="margin-left: 2em"}
::: incremental
1. Definir a hipótese nula $H_0$ e a hipótese alternativa $H_1$
2. Determinar o estimador a ser usado e suas propriedades assintóticas (distribuição, média, variância)
3. Fixar o nível de significância $\alpha$ e construir a região crítica
4. Usar a amosta para calcular o valor do estimador
5. Se o valor da estatística calculada com os dados da amostra estiver na região crítica, rejeitar $H_0$. Caso contrário, não rejeitar
:::
:::


## Observação sobre erro do Tipo I

::: {style="margin-top: 1.5em"}
::: {.callout-caution}
## Devemos sempre tomar como $H_0$ aquela hipótese que, se rejeitada, conduza a um erro do tipo I mais importante de evitar.
Exemplo: 

$H_0$: a produto A é cancerígeno

$H_0$: o réu é inocente
:::
:::




## Exemplo de teste de hipótese 1/2


::: {style="font-size: 1.2em"}
::: {.callout-note}
## Teste para média com variância conhecida
Uma máquina é construída para encher pacotes de café segundo uma distribuição normal com média $\mu = 500g$ e variância $\sigma^2 = 400g^2$. 

A empresa deseja testar se a máquina está enchendo os pacotes com a quantidade correta de café. A empresa coleta uma amostra de 16 pacotes e encontra que a média amostral é $\bar{x} = 492g$. 

A empresa deve para ou não a produção para consertar a máquina?
:::
:::



## Exemplo de teste de hipótese 1/2 {auto-animate="true"}


::: columns
::: {.column width="50%"}

Solução:


\begin{equation*}
\begin{cases}
H_0: & \mu = 500g \\
H_a: & \mu \neq 500g
\end{cases}
\end{equation*}

Sob $H_0$, $\bar{X} \sim N(\mu = 500, \: \sigma_{\bar{x}}^2 = \frac{400}{16})$

::: {style="font-size: 0.7em; margin-top: 1.5em; text-align: right"}

$[\text{lembre-se de que }\sigma_{\bar{x}}^2 = \frac{\sigma^2}{n}]$
:::

:::


::: {.column width="50%"}


```{r}
#| cache: true
#| fig-height: 6.5


normal_args <- c(0, 5)

data.frame(x = -20:20) |>
  ggplot(aes(x)) +
  stat_function(
    fun  = dnorm,
    args = normal_args,
    geom = 'area',
    xlim = c(-20, -10),
    fill = 'steelblue'
  ) +
  stat_function(
    fun  = dnorm,
    args = normal_args,
    geom = 'area',
    xlim = c(10, 20),
    fill = 'steelblue'
  ) +
  stat_function(fun = dnorm,
                args = normal_args) +
  geom_vline(xintercept = c(-10, 10), linetype = "dotted") +
  geom_curve(
    aes(
      x = 12,
      y = 0.003,
      xend = 14,
      yend = 0.02
    ),
    curvature = -0.2,
    arrow = arrow(length = unit(0.03, "npc"), type = "closed")
  ) +
  geom_curve(
    aes(
      x = -12,
      y = 0.003,
      xend = -14,
      yend = 0.02
    ),
    curvature = 0.2,
    arrow = arrow(length = unit(0.03, "npc"), type = "closed")
  ) +
  annotate(
    "text",
    x = 17,
    y = 0.02,
    label = TeX("$\\frac{\\alpha}{2}$"),
    # parse = TRUE,
    size = 15,
    color = "red3"
  ) +
  annotate(
    "text",
    x = -17,
    y = 0.02,
    label = TeX("$\\frac{\\alpha}{2}$"),
    size = 15,
    color = "red3"
  ) +
  scale_x_continuous(breaks = c(-10, 10),
                     labels = c(TeX("$\\bar{x}_{crítico_1}$"), TeX("$\\bar{x}_{crítico_2}$"))) +
  theme_minimal() +
  grids_titulos_normal +
  labs(x = NULL) 
```
:::
:::



## Exemplo de teste de hipótese 1/2 {auto-animate="true"}


::: columns
::: {.column width="65%"}


::: {style="font-size: 0.9em"}
Fixe $\alpha = 1\%$. Pela tabela da normal padrão:

\begin{align*}
z_1 &= -2.58 = \frac{\bar{x}_{c_1} - 500}{5} \longrightarrow \bar{x}_{c_1} = 487,1 \\
z_2 &= 2.58 = \frac{\bar{x}_{c_2} - 500}{5} \longrightarrow \bar{x}_{c_2} = 512,9
\end{align*}


Logo, $RC = \{\bar{x}: \bar{x} \leq 487,1 \text{ ou } \bar{x} \geq 512,9\}$.

:::
Conclusão: [como $\bar{x} = 492$, não rejeitamos $H_0$.]{style="color: blue"}
:::


::: {.column width="35%"}


```{r}
#| cache: true
#| fig-height: 6.5


normal_args <- c(0, 5)

data.frame(x = -20:20) |>
  ggplot(aes(x)) +
  stat_function(
    fun  = dnorm,
    args = normal_args,
    geom = 'area',
    xlim = c(-20, -10),
    fill = 'steelblue'
  ) +
  stat_function(
    fun  = dnorm,
    args = normal_args,
    geom = 'area',
    xlim = c(10, 20),
    fill = 'steelblue'
  ) +
  stat_function(fun = dnorm,
                args = normal_args) +
  geom_vline(xintercept = c(-10, 10), linetype = "dotted") +
  geom_curve(
    aes(
      x = 12,
      y = 0.003,
      xend = 14,
      yend = 0.02
    ),
    curvature = -0.2,
    arrow = arrow(length = unit(0.03, "npc"), type = "closed")
  ) +
  geom_curve(
    aes(
      x = -12,
      y = 0.003,
      xend = -14,
      yend = 0.02
    ),
    curvature = 0.2,
    arrow = arrow(length = unit(0.03, "npc"), type = "closed")
  ) +
  annotate(
    "text",
    x = 17,
    y = 0.02,
    label = "0,5%",
    # parse = TRUE,
    size = 15,
    color = "red3"
  ) +
  annotate(
    "text",
    x = -17,
    y = 0.02,
    label = "0,5%",
    size = 15,
    color = "red3"
  ) +
  scale_x_continuous(breaks = c(-10, 10),
                     labels = c(TeX("$\\bar{x}_{crítico_1}$"), TeX("$\\bar{x}_{crítico_2}$"))) +
  theme_minimal() +
  grids_titulos_normal +
  labs(x = NULL) 
```
:::
:::
















## Exemplo de teste de hipótese 2/2


::: {style="font-size: 1.2em"}
::: {.callout-note}
## Teste para proporção
Uma emissora de TV afirma que 60\% dos televisores estavam ligados no seu programa na última segunda-feira. Uma emissora concorrente acredita que a audiência foi menor. 

A emissora concorrente coleta uma amostra de 200 televisores e encontra que 104 estavam ligados. A emissora concorrente deve acreditar na emissora original? 
:::
:::



## Exemplo de teste de hipótese 2/2 {auto-animate="true"}


::: columns
::: {.column width="50%"}

Solução:

$\hat{p} = \frac{104}{200} = 0,52$

\begin{equation*}
\begin{cases}
H_0: & p = 0,60 \\
H_a: & p < 0,60
\end{cases}
\end{equation*}

[Estatística do teste]{style="text-decoration: underline"}: $\hat{p} \substack{a\\\sim} N(p, \frac{p(1-p)}{n})$



:::


::: {.column width="50%"}


```{r}
#| cache: true
#| fig-height: 6.5


normal_args <- c(0, 5)

data.frame(x = -20:20) |>
  ggplot(aes(x)) +
  stat_function(
    fun  = dnorm,
    args = normal_args,
    geom = 'area',
    xlim = c(-20, -10),
    fill = 'steelblue'
  ) +
  stat_function(fun = dnorm,
                args = normal_args) +
  geom_vline(xintercept = c(-10, 0), linetype = "dotted") +
  geom_curve(
    aes(
      x = -12,
      y = 0.003,
      xend = -14,
      yend = 0.02
    ),
    curvature = 0.2,
    arrow = arrow(length = unit(0.03, "npc"), type = "closed")
  ) +
  annotate(
    "text",
    x = -17,
    y = 0.02,
    label = TeX("$\\alpha$"),
    size = 15,
    color = "red3"
  ) +
  scale_x_continuous(breaks = c(-10, 0),
                     labels = c(TeX("$\\bar{p}_{crítico}$"), "0,6")) +
  theme_minimal() +
  grids_titulos_normal +
  labs(x = NULL) 
```
:::
:::



## Exemplo de teste de hipótese 2/2 {auto-animate="true"}


::: columns
::: {.column width="60%"}


::: {style="font-size: 0.7em"}
Fixe $\alpha = 5\%$. Sob $H_0$, $\hat{p} \sim N(0,60; \frac{0,24}{200})$ e $RC = \{\hat{p}; \hat{p} \leq \hat{p}_{c}  \}$. Com isso:

\begin{align*}
P(\hat{p} \leq \hat{p}_{c}) & = 0,05 \\
P\left(\frac{\hat{p} - 0,60}{\sqrt{\frac{0,24}{200}}} \leq \frac{\hat{p}_{c} - 0,60}{\sqrt{\frac{0,24}{200}}} \right) & = 0,05 \\
P\left(Z \leq \frac{\hat{p}_{c} - 0,60}{\sqrt{\frac{0,24}{200}}} = z \right) & = 0,05
\end{align*}


:::

:::


::: {.column width="40%"}

::: {style="font-size: 0.7em"}
\begin{align*}
\Longrightarrow z & = \frac{\hat{p}_{c} - 0,60}{\sqrt{\frac{0,24}{200}}} = -1,645 \\
\Longrightarrow \hat{p}_{c} & = 0,544
\end{align*}
:::


```{r}
#| cache: true
#| fig-height: 5


normal_args <- c(0, 5)

data.frame(x = -20:20) |>
  ggplot(aes(x)) +
  stat_function(
    fun  = dnorm,
    args = normal_args,
    geom = 'area',
    xlim = c(-20, -10),
    fill = 'steelblue'
  ) +
  stat_function(fun = dnorm,
                args = normal_args) +
  geom_vline(xintercept = c(-10, 0), linetype = "dotted") +
  geom_curve(
    aes(
      x = -12,
      y = 0.003,
      xend = -14,
      yend = 0.02
    ),
    curvature = 0.2,
    arrow = arrow(length = unit(0.03, "npc"), type = "closed")
  ) +
  annotate(
    "text",
    x = -17,
    y = 0.02,
    label = "5%",
    size = 15,
    color = "red3"
  ) +
  scale_x_continuous(breaks = c(-10, 0),
                     labels = c("0,544", "0,6")) +
  theme_minimal() +
  grids_titulos_normal +
  labs(x = NULL) 
```
:::
:::




## Exemplo de teste de hipótese 2/2 {auto-animate="true"}


::: columns
::: {.column width="50%"}

::: {style="font-size: 1.5em; margin-top: 1.2em"}
::: {style="font-size: 0.7em"}
Como $\hat{p}_{observado} = 0,52$ e $\hat{p}_{c} = 0,544$, rejeitamos $H_0$ ao nível de significância de 5\%.

Ou seja, [há evidências]{style="color:red"} de que a proporção de pessoas que a audiência foi menor do que 60\%.
:::

:::

:::


::: {.column width="50%"}



```{r}
#| cache: true
#| fig-height: 6.5


normal_args <- c(0, 5)

data.frame(x = -20:20) |>
  ggplot(aes(x)) +
  stat_function(
    fun  = dnorm,
    args = normal_args,
    geom = 'area',
    xlim = c(-20, -10),
    fill = 'steelblue'
  ) +
  stat_function(fun = dnorm,
                args = normal_args) +
  geom_vline(xintercept = c(-12),
             linetype = "dotted",
             size = 1.5,
             color = "red3") +
  geom_vline(xintercept = c(0),
             linetype = "dotted") +
  scale_x_continuous(breaks = c(-12, 0),
                     labels = c("0,52", "0,6")) +
  theme_minimal() +
  grids_titulos_normal +
  labs(x = NULL) 
```
:::
:::
















# Fim   





